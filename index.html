<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <title>Instructor Map</title>
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            left: 0;
        }

        /* Styles for the new search feature */
        #search-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000; /* Ensure it's above the map */
            width: 300px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            font-family: Arial, sans-serif;
        }

        #instructorSearch {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 5px 5px 0 0;
            border-bottom: none;
        }

        #searchResults {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 5px 5px;
        }

        .search-result-item {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .search-result-item:hover {
            background-color: #f0f0f0;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-item b {
            display: block;
            font-size: 1.1em;
            margin-bottom: 2px;
        }
        .search-result-item small {
            color: #555;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css" />
</head>

<body>
    <div id="search-container">
        <input type="text" id="instructorSearch" placeholder="Search Instructor or Course...">
        <div id="searchResults"></div>
    </div>
    
    <div id="map"></div>

    <script>
        // Initialize the map
        var map = L.map('map', {
            center: [-2.5, 118.0],
            zoom: 5
        });

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
            maxZoom: 18
        }).addTo(map);

        // --- Data Restructured for Searchability ---
        const citiesData = [
            { lat: -6.9175, lon: 107.6191, city: 'Bandung', count: 2, instructors: [
                { name: 'Rahmat Pradana', skill: 'English for Business' },
                { name: 'Arfian Mauliddan', skill: 'Figma'}
            ]},
            { lat: -6.8720, lon: 107.5421, city: 'Cimahi', count: 1, instructors: [
                { name: 'Rifky Nur Hidayat', skill: 'Solidwork' }
            ]},
            { lat: -6.2088, lon: 106.8456, city: 'Jakarta', count: 57, instructors: [
                { name: 'Yani Suiswadi Rusdy', skill: 'English' }, { name: 'Nelly Budiarjo', skill: 'English' },
                { name: 'Arditya Laksono', skill: 'English' }, { name: 'Floreance Sahertian', skill: 'English for Business' },
                { name: 'Raden Nur Prasetyo', skill: 'English' }, { name: 'Indriani Putri Utami', skill: 'English, Excel, Word, PPT' },
                { name: 'Kiki Soraya', skill: 'English' }, { name: 'Halimun Purnama', skill: 'Mandarin' },
                { name: 'Yufan Dalius', skill: 'Mandarin' }, { name: 'Mardiana', skill: 'Marketing' },
                { name: 'Putri Nur Hikmah', skill: 'Softskill Pedagogy' }, { name: 'Fransiska Hanita', skill: 'Accounting, Excel, Tax' },
                { name: 'Mega Amalia', skill: 'Accounting, Excel, Tax' }, { name: 'Fahmi Hasan', skill: 'Office, PPT' },
                { name: 'Panca Octavia', skill: 'Excel, Word, PPT' }, { name: 'Ali Baroroh', skill: 'Power BI, Office, Dashboard' },
                { name: 'Yohan Mulyono', skill: 'CEH' }, { name: 'Aditya Kurniawan', skill: 'CEH' }, { name: 'Kevin', skill: 'CEH' },
                { name: 'Santoso Budijono', skill: 'AWS' }, { name: 'Richard Win', skill: 'AWS' }, { name: 'Ivan Sebastian', skill: 'AWS' },
                { name: 'Rori April L', skill: 'Network, CCNA' }, { name: 'Daniel Datulong', skill: 'Network, CCNA' },
                { name: 'Herdianto', skill: 'Network, CCNA' }, { name: 'Adrian', skill: 'Graphic Design' },
                { name: 'Nathalia Gunarian', skill: 'Graphic Design' }, { name: 'Herman', skill: 'Graphic Design' },
                { name: 'Abdul Basit', skill: 'Graphic Design' }, { name: 'Yacob Utama', skill: 'Digital Marketing' },
                { name: 'Azdin Akbar', skill: 'Digital Marketing' }, { name: 'Setiadi', skill: 'Digital Marketing' },
                { name: 'Yusuf', skill: 'Design, Canva' }, { name: 'Benedict Epifani Janoko', skill: '3D Animasi' },
                { name: 'Tan Gunawan', skill: 'Brevet' }, { name: 'Steven Orlando', skill: 'Brevet' }, { name: 'Rizky Darma', skill: 'Brevet' },
                { name: 'Sebastian Prasetya', skill: 'Brevet' }, { name: 'Thio Helny', skill: 'Brevet' }, { name: 'Evina Sandy', skill: 'Brevet' },
                { name: 'M. Rio Aditya L.', skill: 'Brevet' }, { name: 'Ardiansyah Nur Septian', skill: 'Brevet' },
                { name: 'Thio Jemmi Sutiono', skill: 'Brevet' }, { name: 'Bayu Setyo Winarno', skill: 'Brevet' },
                { name: 'Join Wan Chanlyn', skill: 'Java Programming, Machine Learning, AI' }, { name: 'Annisa Wulandari', skill: 'Python, Machine Learning' },
                { name: 'Yunata Gunawan', skill: 'Machine Learning, AI, Data Analyst' }, { name: 'Zulkarmen', skill: 'Programming, C++' },
                { name: 'Ivanov Adie', skill: 'C++, C#, Javascript' }, { name: 'Rachmat Rizkihadi', skill: 'Java Springboot, PHP' },
                { name: 'Agus Sulaiman', skill: 'Python, Java, C++' }, { name: 'Frans Sinata', skill: 'Python, Java, C++' },
                { name: 'Syaiful Andy', skill: 'Python, Cyber Security' }, { name: 'Hasan Basri', skill: 'Python, NodeJs, Javascript' },
                { name: 'M. Ridwan Maulana', skill: 'Data Analyst, Python, Power BI' }, { name: 'Riki Setiyo Pambudi', skill: 'NodeJs, Javascript' },
                { name: 'M. Arya Dhika', skill: 'Figma' }
            ]},
            { lat: -6.2383, lon: 106.9756, city: 'Bekasi', count: 4, instructors: [
                { name: 'Niko Saputra', skill: 'English for Business' }, { name: 'Poltak Elfrisko', skill: 'Design' },
                { name: 'Reza Syairozi', skill: 'After Effect' }, { name: 'Mahda Karina', skill: 'Brevet' }
            ]},
            { lat: -6.5969, lon: 106.7972, city: 'Bogor', count: 2, instructors: [
                { name: 'Andry Yuriandi', skill: 'English for Business' }, { name: 'Sakti Darmala', skill: 'Solidwork' }
            ]},
            { lat: -6.2024, lon: 106.6527, city: 'Tangerang', count: 5, instructors: [
                { name: 'Mona Intariani', skill: 'English' }, { name: 'Didi Subekti', skill: 'Office, VBA Macro' },
                { name: 'Iswanto', skill: 'Java, C++, C#' }, { name: 'Donny Akhmad Septa Utama', skill: 'PHP, Laravel' },
                { name: 'Hendro Steven', skill: 'Java, NodeJs, ReactJs' }
            ]},
            { lat: -7.7956, lon: 110.3695, city: 'Yogyakarta', count: 2, instructors: [
                { name: 'Masterina Meta', skill: 'English for Business' }, { name: 'Aruna Pandu', skill: 'Korean Language' }
            ]},
            { lat: -5.4500, lon: 105.2663, city: 'Lampung', count: 2, instructors: [
                { name: 'M. Idi', skill: 'English, Softskill Pedagogy' }, { name: 'Anjas Syaiful', skill: 'Blender, Unity' }
            ]},
            { lat: -0.5022, lon: 117.1536, city: 'Samarinda', count: 1, instructors: [
                { name: 'Yudi Susanto', skill: 'Brevet' }
            ]},
            { lat: -6.9667, lon: 110.4167, city: 'Semarang', count: 1, instructors: [
                { name: 'Gustyana Indrasmitha', skill: 'HR, Project Management' }
            ]}
        ];

        const allInstructors = [];
        const markers = {}; // Object to store marker references by city name

        // Reusable table filter function for popups
        function filterTable(tableId, inputId) {
            var filter = document.getElementById(inputId).value.toUpperCase();
            var rows = document.querySelectorAll(`#${tableId} tbody tr`);
            rows.forEach(row => {
                var cells = Array.from(row.getElementsByTagName('td'));
                var match = cells.some(cell => cell.innerText.toUpperCase().indexOf(filter) > -1);
                row.style.display = match ? '' : 'none';
            });
        }

        // Creates a marker and its popup, then returns the marker object
        function createMarkerWithPopup(lat, lon, city, count, data) {
            var tableRows = data.map(item => `
                <tr>
                    <td>${item.name}</td>
                    <td>${item.skill}</td>
                </tr>
            `).join('');

            var popupContent = `
                <b>City:</b> ${city}<br>
                <b>Count:</b> ${count}<br>
                <input type="text" id="search-${city}" onkeyup="filterTable('table-${city}', 'search-${city}')" placeholder="Filter in ${city}..." style="width: 100%; margin: 10px 0 5px; padding: 5px; box-sizing: border-box;">
                <div style="overflow-y: auto; max-height: 150px; border: 1px solid #ddd;">
                    <table id="table-${city}" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2; text-align: left;">
                                <th style="padding: 5px;">Name</th>
                                <th style="padding: 5px;">Skill</th>
                            </tr>
                        </thead>
                        <tbody>${tableRows}</tbody>
                    </table>
                </div>`;
            
            const marker = L.marker([lat, lon]).addTo(map).bindPopup(popupContent, { minWidth: 250 });
            return marker;
        }

        // --- Loop through data to create markers and populate search list ---
        citiesData.forEach(cityData => {
            // Create a marker and store it
            const marker = createMarkerWithPopup(cityData.lat, cityData.lon, cityData.city, cityData.count, cityData.instructors);
            markers[cityData.city] = marker;

            // Add each instructor to the global search list with their location info
            cityData.instructors.forEach(instructor => {
                allInstructors.push({
                    ...instructor, // spread operator to copy name and skill
                    city: cityData.city,
                    lat: cityData.lat,
                    lon: cityData.lon
                });
            });
        });
        
        // --- New Search Functionality ---
        const searchInput = document.getElementById('instructorSearch');
        const resultsContainer = document.getElementById('searchResults');

        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase().trim();
            resultsContainer.innerHTML = ''; // Clear previous results

            if (searchTerm.length < 1) {
                return; // Don't show results for empty input
            }

            const matches = allInstructors.filter(instructor =>
                instructor.name.toLowerCase().includes(searchTerm) ||
                instructor.skill.toLowerCase().includes(searchTerm)
            );

            matches.forEach(match => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.innerHTML = `<b>${match.name}</b><small>${match.skill} &middot; ${match.city}</small>`;
                
                resultItem.addEventListener('click', () => {
                    map.flyTo([match.lat, match.lon], 13); // Zoom to the city
                    markers[match.city].openPopup();      // Open the city's popup
                    
                    // Clear search after selection
                    searchInput.value = '';
                    resultsContainer.innerHTML = '';
                });

                resultsContainer.appendChild(resultItem);
            });
        });

        // Hide search results when clicking anywhere on the map
        map.on('click', () => {
            resultsContainer.innerHTML = '';
        });

    </script>
</body>

</html>